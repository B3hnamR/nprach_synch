# Deep Learning-Based Synchronization for Uplink NB-IoT — متن و فرمول‌های قابل کپی

این فایل یک نسخه‌ی تمیز و قابل‌کپی از مفاهیم و فرمول‌های اصلی روش همگام‌سازی NPRACH (بر اساس مقاله‌ی Aït Aoudia et al., 2022) است. تمام فرمول‌ها به‌صورت LaTeX نوشته شده‌اند تا در VS Code و سایر ویرایشگرها به‌راحتی قابل استفاده باشند.

نکات استفاده:
- فرمت فایل Markdown است؛ در VS Code می‌توانید با افزونه‌های پیش‌نمایش Markdown/LaTeX، فرمول‌ها را ببینید یا صرفاً متن را کپی کنید.
- همه‌ی نمادها و معادلات شماره‌گذاری شده‌اند. اگر به رفرنس کامل نیاز دارید، به مقاله‌ی اصلی در arXiv:2205.10805 مراجعه کنید.

---

## 1) مقدمه (خلاصه)
NPRACH (کانال دسترسی تصادفی باریک‌باند) در NB‑IoT برای شناسایی دستگاه (UE) و ب��آورد زمان رسیدن (ToA) و آفست فرکانسی حامل (CFO) استفاده می‌شود. شکل موج NPRACH بر پایه‌ی پیش‌نواختار (پری‌امبل) تک‌تن با جهش فرکانسی شبه‌تصادفی است. در یک سلول، تا 48 الگوی جهش مستقل برای UEها وجود دارد (بدون تصادم). هدف، تشخیص UEهای فعال و برآورد ToA/CFO آن‌ها از داده‌ی دریافتی است.

یادگیری عمیق می‌تواند بدون تکیه بر فرضیات ساده‌کننده (مانند تخت بودن پاسخ فرکانسی، عدم تداخل، یا ثابت بودن کانال) و بدون نیاز به آستانه‌گذاری دستی برای تشخیص، عملکرد بهتری نسبت به روش‌های کلاسیک ارائه دهد.

---

## 2) مدل سیستم و سیگنال‌ها

### 2.1) سیگنال تک‌تن OFDM کاربر k
پری‌امبل شامل گروه‌های نماد (SG) است. هر SG از 5 نماد OFDM با یک CP مشترک تشکیل شده و روی یک زیرحامل (tone) از پهنای 3.75 kHz قرار می‌گیرد. اگر \(\phi_k[m]\) شاخص زیرحاملِ انتخاب‌شده برای کاربر \(k\) در SG شماره‌ی \(m\) باشد، سیگنال تک‌ت�� OFDM برای نماد \(i\) از آن SG در حوزه‌ی زمان (پس از نمونه‌برداری) به‌صورت زیر مدل می‌شود:

$$
s_{k,m,i}[n] \,=\; \beta_k \, e^{j\,2\pi\,\phi_k[m]\,\frac{n}{N}} \tag{1}
$$

که در آن \(\beta_k\) توان ارسالی (یا ضریب دامنه) کاربر \(k\)، \(N\) اندازه‌ی DFT (تعداد نمونه در هر نماد بدون CP)، و \(\phi_k[m]\) شاخص زیرحامل فعال در SG شماره‌ی \(m\) است.

### 2.2) کانال چندمسیره زمان-ناوردا
کانال پیوسته‌ی کاربر \(k\) به‌صورت ضربه‌ای مدل می‌شود:

$$
h_k(\tau) \,=\; \sum_{p=0}^{P_k-1} a_{k,p}\, \delta(\tau - \tau_{k,p}) \tag{2}
$$

که در آن \(P_k\) تعداد مسیرها، \(a_{k,p}\) ضریب مسیر \(p\)، و \(\tau_{k,p}\) تأخیر آن مسیر است. زمان رسیدن (ToA) کاربر \(k\) به‌صورت کمینه‌ی تأخیر مسیرها تعریف می‌شود:

$$
D_k \,:=\; \min_{p} \, \tau_{k,p} \tag{3}
$$

### 2.3) سیگنال دریافتی با CFO و نویز
سیگنال گسسته‌ی دریافتی (پس از نمونه‌برداری) در BS با درنظرگرفتن آفست فرکانسی ��رمال‌شده‌ی \(f_{\text{off},k}\) برای هر کاربر و نویز AWGN:

$$
y_{m,i}[n] \,=\; \sum_{k=0}^{K-1} \sum_{\ell=-\infty}^{\infty} A_k \, h_{k,\ell} \, s_{k,m,i}[n - \ell] \, e^{j \, 2\pi \, f_{\text{off},k} (n-\ell)} \, + \, w_{m,i}[n] \tag{4}
$$

که \(A_k\in\{0,1\}\) نشانگر فعالیت کاربر \(k\)، \(h_{k,\ell}\) تپ کانال گسسته، \(w_{m,i}[n] \sim \mathcal{CN}(0,\sigma^2)\) نویز، و جمع روی \(\ell\) در شبیه‌سازی روی بازه‌ی محدود \([L_{\min},\,L_{\max}]\) اعمال می‌شود.

### 2.4) ضرایب کانال گسسته با شکل‌دهی sinc
با فرض پالسی sinc در فرستنده و فیلتر منطبق در گیرنده، ضرایب گسسته‌ی کانال در نمونه‌ی \(\ell\) تقریباً برابر است با:

$$
h_{k,\ell} \,=\; \sum_{p=0}^{P_k-1} a_{k,p}\, \mathrm{sinc}\big(\ell - W\,\tau_{k,p}\big)
\;=\; \mathcal{F}^{-1}\!\left\{ \mathrm{rect}(f)\, H_k(f)\right\}(\ell) \tag{5–6}
$$

که در آن \(W = N\,\Delta f\) پهنای باند و پاسخ فرکانسی کانال برابر است با:

$$
H_k(f) \,=\; \sum_{p=0}^{P_k-1} a_{k,p} \, e^{-j\, 2\pi \, \tau_{k,p} \, W \, f} \tag{7}
$$

---

## 3) پردا��ش گیرنده و شبکه منبع (Resource Grid)
پس از حذف CP، روی هر SG تبدیل DFT اعمال می‌شود و شبکه‌ی منبع (RG) با ابعاد \(N \times 5S\) به‌دست می‌آید (در هر SG پنج نماد OFDM وجود دارد). شاخص زمان-نماد \(5m+i\) و شاخص زیرحامل \(\phi_k[m]\) است. مؤلفه‌ی دریافتی روی زیرحامل فعال کاربر \(k\) برای SG شماره‌ی \(m\) و نماد \(i\):

$$
\begin{aligned}
Y[\phi_k[m],\, 5m+i] \,=&\; A_k\, H_k\!\left(\frac{\phi_k[m]}{N}\right)\, \beta_k \cdot \frac{1}{N} \sum_{n=N_{m,i}}^{N_{m,i}+N-1} e^{j\, 2\pi\, f_{\text{off},k} \, n} \\
&+ \sum_{k'\neq k} A_{k'}\, H_{k'}\!\left(\frac{\phi_{k'}[m]}{N}\right)\, \beta_{k'} \cdot \frac{1}{N} \sum_{n=N_{m,i}}^{N_{m,i}+N-1} e^{j\,2\pi\,\left(\frac{\phi_{k'}[m]-\phi_k[m]}{N} + f_{\text{off},k'}\right) n} \\
&+ W_{k,m,i}[\phi_k[m],\, 5m+i]
\end{aligned} \tag{8}
$$

که \(N_{m,i} := m\, N_{\text{SG}} + i\,N\) و \(N_{\text{SG}}\) تعداد نمونه در هر SG است. اثر CFOِ کاربران دیگر باعث ICI می‌شود.

---

## 4) روش یادگیری عمیق (DeepNSynch)
### 4.1) پیش‌پردازش برای ورودی شبکه
1) پنج RE هر SG برای هر زیرحامل جداگانه میانگین‌گیری می‌شوند تا اندازه‌ی ورودی 5 برابر کاهش یابد و \(\tilde{Y} \in \mathbb{C}^{N\times S}\) حاصل شود.
2) سپس بر اساس الگوهای جهش استاندارد، \(K\) دنباله‌ی SG متناظر جمع‌آوری و جداگانه نرمال‌سازی می‌شوند (\(\tilde{y}_k\in\mathbb{C}^S\)).
3) قسمت‌های حقیقی/موهومی روی محور داخلی چسبانده و توان میانگینِ دنباله در مقیاس لگاریتمی محاسبه و ضمیمه می‌شود تا \(S\times 3\) به‌ازای هر الگو تشکیل شود.
4) در انتها، این بازنمایی به شبکه‌ی زمان–فرکانس \(\bar{Y}\in\mathbb{R}^{K\times S\times 3}\) بازچینش می‌شود تا شبکه‌ها روی محور فرکانس/زمان (برای مقابله با ICI ناشی از CFO) عمل کنند.

### 4.2) معماری شبکه
\(\bar{Y}\) به دو شبکه‌ی مشابه تغذیه می‌شود: یکی احتمال فعالیت \(\widehat{\Pr}(A_k \mid \bar{Y})\) را خروجی می‌دهد و دیگری \(\widehat{D}_k\) و \(\hat f_{\text{off},k}\) را. بخش کانولوشنی از 1D depth-wise separable conv با 128 کرنل (اندازه 3) و اتصالات Residual استفاده می‌کند. سپس به‌ازای هر الگوی جهش، دنباله‌ها جمع‌آوری و به MLPها داده می‌شوند؛ یک MLP برای تشخیص فعالیت و یک MLP با دو سرِ خروجی برای برآورد ToA/CFO.

---

## 5) توابع زیان (Loss)
### 5.1) تشخیص فعالیت — Binary Cross-Entropy
تابع زیان تشخیص فعالیت:

$$
L_1 \,:=\; - \sum_{k=0}^{K-1} \mathbb{E}\!\left[ \ln \big( \widehat{\Pr}(A_k \mid \bar{Y}) \big) \right] \tag{9}
$$

برآورد مونت‌کارلو روی بچِ \(B\):

$$
\begin{aligned}
L_1 \,\approx\;& -\frac{1}{B} \sum_{b=0}^{B-1} \sum_{k=0}^{K-1} \Big( A_k^{[b]} \, \ln \widehat{\Pr}(A_k^{[b]} \mid \bar{Y}^{[b]}) \\
&+ (1-A_k^{[b]}) \, \ln \big(1 - \widehat{\Pr}(A_k^{[b]} \mid \bar{Y}^{[b]})\big) \Big)
\end{aligned} \tag{10}
$$

### 5.2) برآورد ToA/CFO — MSE وزن‌دار با SNR و فعالیت
تابع زیانِ رگرسیون ToA/CFO که فقط روی کاربران فعال و با وزن SNR اعمال می‌شود:

$$
L_2 \,:=\; \sum_{k=0}^{K-1} \mathbb{E}\!\left[ A_k\, \mathrm{SNR}_k \, (D_k - \widehat{D}_k)^2 \right] \, + \, \sum_{k=0}^{K-1} \mathbb{E}\!\left[ A_k\, \mathrm{SNR}_k \, ( f_{\text{off},k} - \hat f_{\text{off},k} )^2 \right] \tag{11}
$$

که در آن SNR متوسط کاربر \(k\):

$$
\mathrm{SNR}_k \,:=\; \frac{\beta_k}{\sigma^2}\, \frac{1}{S} \, \sum_{m=0}^{S-1} \left| H_k\!\left( \frac{\phi_k[m]}{N} \right) \right|^2 \tag{12}
$$

برآورد تجربی \(L_2\) روی بچ:

$$
\begin{aligned}
L_2 \,\approx\;& \frac{1}{B} \sum_{k=0}^{K-1} \sum_{b=0}^{B-1} A_k^{[b]}\, \mathrm{SNR}_k^{[b]} \, \big(D_k^{[b]} - \widehat{D}_k^{[b]}\big)^2 \\
&+ \frac{1}{B} \sum_{k=0}^{K-1} \sum_{b=0}^{B-1} A_k^{[b]}\, \mathrm{SNR}_k^{[b]} \, \big(f_{\text{off},k}^{[b]} - \hat f_{\text{off},k}^{[b]}\big)^2
\end{aligned} \tag{13}
$$

### 5.3) زیان کل

$$
L \,:=\; L_1 + L_2 \tag{14}
$$

---

## 6) نکات شبیه‌سازی
- مدل کانال: 3GPP UMi (مطابق TS 38.901)
- فرکانس حامل: \(3.4\,\text{GHz}\)
- نرخ نمونه‌برداری: \(50\,\text{MHz}\)
- پری‌امبل: فرمت 0، ��ک تکرار \(S=4\)، فاصله‌ی زیرحامل \(\Delta f = 3.75\,\text{kHz}\)
- حداکثر \(K=48\) الگوی جهش بدون تصادم در سلول
- آستانه‌ی baseline با هدف \(\text{PFA}=0.999\) و FFT=256 (یا بسته به آزمایش)
- آموزش: Adam با batch=64 و \(\text{lr}=10^{-3}\) (در مقاله)

---

## 7) راهنمای ذخیره/نمایش در VS Code
- همین فایل (formulas.md) را باز کنید.
- برای پیش‌نمایش فرمول‌ها، افزونه‌های Markdown Preview یا Markdown+Math را نصب کنید (اختیاری).
- برای کپیِ دقیق فرمول‌ها، متن LaTeX داخل بلوک‌ها (بین \$\$) را کپی کنید.
- اگر به سورس کامل LaTeX نیاز دارید، «Other formats → Source» را از صفحه‌ی arXiv دریافت کنید.

---

## 8) یادداشت‌ها و سازگاری نمادها
- \(N\) اندازه‌ی DFT (تعداد نمونه‌ی نماد بدون CP) است؛ \(\Delta f\) فاصله‌ی زیرحامل و \(W=N\,\Delta f\) پهنای باندِ موثر.
- \(\phi_k[m]\) شاخص زیرحامل در الگوی جهش کاربر \(k\) در SG شماره‌ی \(m\) است.
- \(f_{\text{off},k}\) آفست فرکانسی نرمال‌شده نسبت به نرخ نمونه‌برداری است.
- RG با ابعاد \(N \times 5S\) پس از DFT هر SG به‌دست می‌آید؛ اندیس ستون \(5m+i\) به نماد \(i\) از SG شماره‌ی \(m\) اشاره می‌کند.

---

## 9) منابع پی��نهادی
- Aït Aoudia et al., "Deep Learning-Based Synchronization for Uplink NB-IoT", arXiv:2205.10805 (2022)
- 3GPP TS 38.901 (مدل کانال UMi)
- 3GPP TS 36.211 / 38.211 (کانال‌ها و مدولاسیون)
